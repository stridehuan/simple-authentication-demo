# Simple Authentication Demo

## 1 需求简述
### 1.1 业务实体
开发一个授权和鉴权的服务，包含以下实体：
1. 用户（包含用户名和密码）
2. 角色（包含角色名）
用户和角色之间是多对多关系：一个用户可以关联多个角色，一个角色可以被多个用户关联

### 1.2 服务支持的能力
模拟一个服务，支持客户端进行如下操作：
1. 创建/删除 用户
2. 创建/删除 角色
3. 给用户授权角色
4. 鉴权（校验用户名密码，通过后生成token用于维护会话）
5. 查询用户拥有的角色

### 1.3 关于服务模型
提供的接口不涉及网络IO，在进程内模拟调用接口方法即可，通过测试用例验证
不需要持久化的数据源，数据保存在内存中即可

## 2 核心模块设计

### 2.1 整体模块划分
整体设计图如下：
<img src="image/model_diagram.jpg" alt="SendDataBySocket" style="zoom:50%;" />

可对任务拆分成以下几个主要模块：
1. 数据源
2. 业务处理服务
   - 用户
   - 角色
   - 鉴权
3. 业务线程池
4. 对外门面接口

线程模型图如下：
<img src="image/thread_model.jpg" alt="SendDataBySocket" style="zoom:50%;" />
本次需求客户端、服务端都在一个进程中完成，通过测试用例的方式触发操作，所以图中的主线程就是测试用例的启动线程，然后在主线程中启动线程模拟客户端，直接调用目标服务的接口方法模拟接口调用，目标服务在处理接口请求时会统一丢到线程池中进行处理，待处理完成后，返回处理结果给客户端线程。

### 2.2 数据模型
数据保存在内存中，uml类图如下：
<img src="image/datasource_uml.jpg" alt="SendDataBySocket" style="zoom:50%;" />
- User 和 Role 的唯一键是name，通过ConcurrentHashMap组成数据集，key是name，未避免线程安全问题用ConcurrentHashMap存储
- User会通过roles属性关联Role，roles里面存的是Role的唯一键，也就是name
- Role也会通过users属性关联User，users里面存的是User的唯一键，也就是name
- User 和 Role 做更新的时候需要绑定或解绑彼此的关联关系，这部分规则封装在DataSource中，DataSource是对数据及其操作的封装，服务启动的时候会创建一个单例

### 2.3 核心业务处理


### 2.4 业务线程池


### 2.5 门面接口


## 3 测试用例设计

### 3.1 核心模块单测



### 3.2 业务场景测试




















